<!DOCTYPE html>
<html lang="en">

<head>
    <title>THREE.IK - skinned mesh test</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: Monospace;
            background-color: #000;
            color: #fff;
            margin: 0px;
            overflow: hidden;
        }

        #info {
            color: #fff;
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            z-index: 100;
            display: block;
        }

        #info a {
            color: #046;
            font-weight: bold;
        }

    </style>
</head>

<body>
    <script src="scripts/dat.gui.js"></script>
    <script src="scripts/three.js"></script>
    <script src="scripts/OrbitControls.js"></script>
    <script src="scripts/FBXLoader.js"></script>
    <script src="scripts/IKApp.js"></script>
    <script src="../build/three-ik.js"></script>
    <script>
        class SingleTargetApp extends IKApp {
            setupGUI() {
                this.config.constraintType = 'ball';
                this.config.constraintAngle = 90;

            }

            setupIK() {

                var fbxLoader = new THREE.FBXLoader()
                fbxLoader.load('assets/rigTest-03.fbx', (rigGroup) => {
                this.scene.add(rigGroup)

                var rigMesh = rigGroup.children[0];
                rigMesh.material = new THREE.MeshPhysicalMaterial({
                  skinning: true,
                  wireframe: true
                })

                this.target = new THREE.Object3D()
                this.target.position.set(1,0,5)
                this.scene.add(this.target)

                var boneGroup = rigGroup.children[1].children[0];
                var ik = new IK.IK();
                const chain = new IK.IKChain();
                var currentBone = boneGroup
                for (let i = 0; i < 4; i++) {
                  currentBone = currentBone.children[0]
                  var constraints = [new IK.IKBallConstraint(90)];
                  const target = i === 3 ? this.target : null;
                  chain.add(new IK.IKJoint(currentBone, { constraints }), { target });
                }
                ik.add(chain);
                console.log(chain)
                const helper = new IK.IKHelper(ik);
                this.scene.add(helper);

                this.iks.push(ik)
              }, console.log, console.log);
            }

            onChange() {
                super.onChange();
            }

            update() {
              if(this.target){
                this.target.position.y = 1+4*Math.sin(0.005*performance.now())
              }
            }
        };

        window.app = new SingleTargetApp();

    </script>
</body>

</html>
